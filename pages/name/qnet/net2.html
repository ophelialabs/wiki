@page "/networks2"
@using System.Collections.Generic
@inject IJSRuntime JS

<link rel="stylesheet" href="@Assets["css/networks2.css"]" />

<div class="networks-container">
    <div class="globe-header">
        <h1>üåç Quantum Networks - 3D Globe View</h1>
        <p>Interactive 3D globe showing quantum network nodes and connectivity</p>
    </div>

    <div class="controls-panel">
        <button class="control-btn" @onclick="() => RotateGlobe(true)">‚Üª Rotate</button>
        <button class="control-btn" @onclick="ResetView">‚ü≤ Reset View</button>
        <button class="control-btn" @onclick="ToggleLabels">üè∑Ô∏è Toggle Labels</button>
    </div>

    <div id="globe-container" class="globe-wrapper">
        <div id="map"></div>
    </div>

    <div class="network-info">
        <h3>Active Nodes</h3>
        <ul class="nodes-list">
            @foreach (var node in NetworkNodes)
            {
                <li class="node-item" @onclick="() => FocusNode(node)">
                    <span class="node-name">@node.Name</span>
                    <span class="node-status">@node.Status</span>
                </li>
            }
        </ul>
    </div>
</div>

@code {
    private List<QuantumNode> NetworkNodes = new();
    private bool showLabels = true;
    private bool isRotating = false;
    const string API_KEY = "AIzaSyDK7BXtZz4ypjq0yr-7FrrAcl3oCoPpxK8";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await LoadNetworkNodes();
            await InitializeGlobe();
        }
    }

    private async Task InitializeGlobe()
    {
        try
        {
            await JS.InvokeVoidAsync("initializeGoogleGlobe", API_KEY, NetworkNodes);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error initializing globe: {ex.Message}");
        }
    }

    private Task LoadNetworkNodes()
    {
        NetworkNodes = new List<QuantumNode>
        {
            new QuantumNode 
            { 
                Id = 1, 
                Name = "Chattanooga Hub", 
                Latitude = 35.0456, 
                Longitude = -85.2672, 
                Status = "üü¢ Active",
                Capacity = 250
            },
            new QuantumNode 
            { 
                Id = 2, 
                Name = "Oak Ridge Node", 
                Latitude = 35.9181, 
                Longitude = -84.2679, 
                Status = "üü¢ Active",
                Capacity = 180
            },
            new QuantumNode 
            { 
                Id = 3, 
                Name = "Atlanta Center", 
                Latitude = 33.7490, 
                Longitude = -84.3880, 
                Status = "üü¢ Active",
                Capacity = 300
            },
            new QuantumNode 
            { 
                Id = 4, 
                Name = "Washington Node", 
                Latitude = 38.9072, 
                Longitude = -77.0369, 
                Status = "üü° Connecting",
                Capacity = 120
            },
            new QuantumNode 
            { 
                Id = 5, 
                Name = "Boston Labs", 
                Latitude = 42.3601, 
                Longitude = -71.0589, 
                Status = "üü¢ Active",
                Capacity = 220
            }
        };
        return Task.CompletedTask;
    }

    private async Task RotateGlobe(bool enable)
    {
        isRotating = !isRotating;
        await JS.InvokeVoidAsync("toggleGlobeRotation", isRotating);
    }

    private async Task ResetView()
    {
        await JS.InvokeVoidAsync("resetGlobeView");
    }

    private async Task ToggleLabels()
    {
        showLabels = !showLabels;
        await JS.InvokeVoidAsync("toggleLabels", showLabels);
    }

    private async Task FocusNode(QuantumNode node)
    {
        await JS.InvokeVoidAsync("focusNode", node.Latitude, node.Longitude, node.Name);
    }

    public class QuantumNode
    {
        public int Id { get; set; }
        public string? Name { get; set; }
        public double Latitude { get; set; }
        public double Longitude { get; set; }
        public string? Status { get; set; }
        public int Capacity { get; set; }
    }
}