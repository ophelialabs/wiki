<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Saturn | Ophelia</title>
<!-- Bootstrap & Site CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background: #1e293b; color: #f1f5f9; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; }
#globe-container { width: 100vw; height: 100vh; }
.chess-controls {
margin-bottom: 1rem;
display: flex;
justify-content: center;
align-items: center;
gap: 1rem;
width: 100%;
}
.map-placeholder {
width: 100%;
}
.center-container {
width: 100%;
display: flex;
flex-direction: column;
align-items: center;
}
</style>
</head>
<body>
<main>
<!-- Map Section -->
<div class="map-placeholder">
<div id="globe-container"></div>
                
</div>
</div>
</main>
<script>
// Google Maps JS API Loader and main scripts
(g => {
var h, a, k, p = "The Google Maps JavaScript API", c = "google", l = "importLibrary", q = "__ib__", m = document, b = window;
b = b[c] || (b[c] = {});
var d = b.maps || (b.maps = {}), r = new Set, e = new URLSearchParams, u = () => h || (h = new Promise(async (f, n) => {
await (a = m.createElement("script"));
e.set("libraries", [...r] + "");
for (k in g) e.set(k.replace(/[A-Z]/g, t => "_" + t[0].toLowerCase()), g[k]);
e.set("callback", c + ".maps." + q);
a.src = `https://maps.${c}apis.com/maps/api/js?` + e;
d[q] = f;
a.onerror = () => h = n(Error(p + " could not load."));
a.nonce = m.querySelector("script[nonce]")?.nonce || "";
m.head.append(a)
}));
d[l] ? console.warn(p + " only loads once. Ignoring:", g) : d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n))
})({
key: "AIzaSyDK7BXtZz4ypjq0yr-7FrrAcl3oCoPpxK8",
v: "alpha"
});

let map3D;
        let marker;

        // Function to pan the map to a location, with an optional marker
        function panToLocation(lat, lng, name) {
            if (map3D) {
                map3D.setCamera({
                    center: { lat, lng },
                    zoom: 6,
                });

                // Remove previous marker if exists
                if (marker && marker.parentElement) {
                    marker.parentElement.removeChild(marker);
                }

                // Add a marker at the searched location
                if (window.google && window.google.maps && window.google.maps.marker) {
                    const { PinElement } = window.google.maps.marker;
                    marker = new PinElement({
                        position: { lat, lng },
                        title: name,
                    });
                    map3D.appendChild(marker);
                }
            }
        }

        async function geocodeLocation(query) {
            // Use Google Maps Geocoding API
            const apiKey = "AIzaSyDK7BXtZz4ypjq0yr-7FrrAcl3oCoPpxK8";
            const url = `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(query)}&key=${apiKey}`;
            try {
                const response = await fetch(url);
                const result = await response.json();
                if (result.status === "OK" && result.results.length > 0) {
                    const location = result.results[0].geometry.location;
                    return { lat: location.lat, lng: location.lng, name: result.results[0].formatted_address };
                } else {
                    alert("Location not found!");
                    return null;
                }
            } catch (err) {
                alert("Error finding location.");
                return null;
            }
        }

        
// 
async function init() {
const { Map3DElement, MapMode } = await google.maps.importLibrary("maps3d");
await google.maps.importLibrary('marker'); // ensure marker lib loaded

map3D = new Map3DElement({
mode: MapMode.HYBRID,
});

// Initial globe
document.getElementById('globe-container').append(map3D);

// Search button event
document.getElementById('search-btn').addEventListener('click', async () => {
const query = document.getElementById('location-search').value.trim();
if (query) {
const loc = await geocodeLocation(query);
if (loc) {
panToLocation(loc.lat, loc.lng, loc.name);
}
}
});

// Allow pressing Enter in the search bar
document.getElementById('location-search').addEventListener('keydown', async (e) => {
if (e.key === "Enter") {
const query = document.getElementById('location-search').value.trim();
if (query) {
const loc = await geocodeLocation(query);
if (loc) {
panToLocation(loc.lat, loc.lng, loc.name);
}
}
}
});
}

document.addEventListener('DOMContentLoaded', () => {
init();
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>